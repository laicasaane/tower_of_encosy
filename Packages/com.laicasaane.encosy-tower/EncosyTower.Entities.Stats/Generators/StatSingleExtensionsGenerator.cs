#if UNITY_EDITOR && ANNULUS_CODEGEN && !ENCOSY_STAT_VALUE_TYPES_GENERATOR

using System;
using EncosyTower.CodeGen;
using UnityCodeGen;

namespace EncosyTower.Entities.Stats.Generators
{
    [Generator]
    internal sealed class StatSingleExtensionsGenerator : ICodeGenerator
    {
        public void Execute(GeneratorContext context)
        {
            var p = Printer.DefaultLarge;
            p.PrintAutoGeneratedBlock(nameof(StatSingleExtensionsGenerator));
            p.PrintEndLine();
            p.PrintLine(@"#pragma warning disable

using System.Runtime.CompilerServices;
using Unity.Mathematics;
");

            p.PrintLine("namespace EncosyTower.Entities.Stats");
            p.OpenScope();
            {
                var types = GeneratorAPI.Types.AsSpan();
                var typeNames = GeneratorAPI.TypeNames.AsSpan();
                var equalOperators = GeneratorAPI.EqualOperators.AsSpan();
                var sizes = GeneratorAPI.Sizes.AsSpan();

                p.PrintLine("public static partial class StatSingleValueExtensions");
                p.OpenScope();
                {
                    for (var i = 1; i < typeNames.Length; i++)
                    {
                        var type = types[i];
                        var typeName = typeNames[i];
                        var size = sizes[i];

                        p.PrintLine(GeneratorAPI.AGGRESSIVE_INLINING);
                        p.PrintBeginLine("public static StatSingle<").Print(type).Print("> ToStatSingle(this ")
                            .PrintSelect("in ", "", size > 8).Print(type).PrintEndLine(" value)");
                        p.WithIncreasedIndent().PrintLine("=> new(value);");
                        p.PrintEndLine();
                    }
                }
                p.CloseScope();
                p.PrintEndLine();
            }
            p.CloseScope();
            p.PrintEndLine();

            context.OverrideFolderPath(CodeGenAPI.GetOutputFolderPathFromCaller(pathCombine: GeneratorAPI.COMMON_FOLDER));
            context.AddCode($"StatSingleExtensions.gen.cs", p.Result);
        }
    }
}

#endif
